// prisma/schema.prisma
datasource db {
  provider  = "postgresql"
  url  	    = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User{
    userSystemId        String @id @default(cuid())　//共通で使うユーザー区別用のシステムID
    name                String?　//グーグルニックネーム
    email               String? @unique　//グーグルメールアドレス
    emailVerified       DateTime?　//認証日時
    image               String?　//プロフィール画像（グーグルのURL）
    createdAt           DateTime @default(now())　//作成日時
    updatedAt           DateTime @updatedAt　//更新日時

    accounts            Account[]
    sessions            Session[]
    taskLogs            UserTaskPersonalLog[]
}

model Account {
    id                  String @id @default(cuid())
    userSystemId        String
    type                String  //login type
    provider            String  //google
    providerAccountId   String
    token_type          String?
    scope               String?
    id_token            String?  @db.Text
    createdAt           DateTime @default(now())
    updatedAt           DateTime @updatedAt
    access_token        String?  @db.Text
    expires_at          Int?
    refresh_token       String?  @db.Text
    session_state       String?

    user User @relation(fields: [userSystemId], references: [userSystemId], onDelete: Cascade)
    @@unique([provider, providerAccountId])
}

model Session{
    id                  String @id @default(cuid())
    userId              String
    userSystemId        String
    sessionToken        String @unique
    expires             DateTime
    user User @relation(fields: [userSystemId], references: [userSystemId], onDelete: Cascade)
}

model VerificationToken{
    identifier          String
    token               String @unique
    expires             DateTime

    @@unique([identifier, token])
}

model UserTaskPersonalLog{
    userSystemId        String
    createdAt           DateTime @default(now())
    updatedAt           DateTime @updatedAt
    taskDateId          DateTime @db.Date //タスク日付(example : 2025-10-18)
    taskTempTxt         Json?        //もらったスクショ二つを分析した内容をJSONで保存
    taskContent         String?      //タスク内容
    user User @relation(fields: [userSystemId], references: [userSystemId], onDelete: Cascade)
    @@id([userSystemId, taskDateId])
    @@index([userSystemId, taskDateId(desc)])
}